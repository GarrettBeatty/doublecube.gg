name: Test Claude Changes

  on:
    pull_request:
      branches: [ main ]
    push:
      branches:
        - 'claude/**'  # Auto-run on Claude branches

  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4

        - name: Setup .NET
          uses: actions/setup-dotnet@v4
          with:
            dotnet-version: '8.0.x'

        - name: Build
          run: dotnet build

        - name: Test
          run: dotnet test --verbosity normal

        - name: Comment Result
          if: always()
          uses: actions/github-script@v7
          with:
            script: |
              const status = '${{ job.status }}' === 'success' ? '✅ Tests passed' : '❌ Tests failed';
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: status
              });
