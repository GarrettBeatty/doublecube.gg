<!DOCTYPE html>
<html lang="en" data-theme="night">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backgammon Online</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.24/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Shared Header (visible on all pages) -->
    <header id="appHeader" class="bg-gradient-to-br from-primary to-secondary text-white px-6 py-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <!-- Left: Logo -->
            <div class="flex items-center gap-4 cursor-pointer" onclick="showLandingPage()">
                <h1 class="text-2xl font-bold">Backgammon Online</h1>
            </div>

            <!-- Right: Connection + Auth -->
            <div class="flex items-center gap-4">
                <!-- Connection Indicator -->
                <div id="connectionIndicator">
                    <span class="loading loading-ring loading-sm text-error"></span>
                </div>

                <!-- Auth Section (unauthenticated) -->
                <div id="authSection" class="flex gap-2">
                    <button class="btn btn-outline btn-sm text-white border-white hover:bg-white hover:text-primary" onclick="showLoginModal()">Login</button>
                    <button class="btn btn-accent btn-sm" onclick="showRegisterModal()">Sign Up</button>
                </div>

                <!-- User Section (authenticated) -->
                <div id="userSection" style="display: none;" class="flex items-center gap-2">
                    <span id="usernameDisplay" class="font-semibold"></span>
                    <button class="btn btn-ghost btn-sm text-white" onclick="showProfileModal()">Profile</button>
                    <button class="btn btn-error btn-sm" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Landing Page -->
    <div id="landingPage" class="page min-h-screen bg-gradient-to-br from-primary to-secondary">
        <div class="max-w-5xl mx-auto px-4 py-8">
            <!-- Main Content Card -->
            <div class="card bg-base-100 shadow-2xl">
                <div class="card-body">
                    <!-- Action Buttons -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <button class="btn btn-primary btn-lg h-auto py-6 flex-col gap-2" onclick="createGame()">
                            <span class="text-3xl">+</span>
                            <span class="text-lg">Create New Game</span>
                        </button>
                    </div>

                    <!-- My Games Section -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold mb-4">My Games</h2>
                        <div id="myGamesList" class="space-y-2">
                            <p class="text-base-content/60 text-center py-8 italic">Loading your games...</p>
                        </div>
                    </div>

                    <!-- Friends Section (visible when logged in) -->
                    <div id="friendsSection" style="display: none;" class="mb-8">
                        <h2 class="text-xl font-bold mb-4">Friends</h2>
                        <div class="join w-full mb-4">
                            <input type="text" id="friendSearch" placeholder="Search users to add..." class="input input-bordered join-item flex-1">
                            <button onclick="performUserSearch()" class="btn btn-primary join-item">Search</button>
                        </div>
                        <div id="userSearchResults" class="space-y-2"></div>
                        <div id="friendRequests" class="space-y-2"></div>
                        <div id="friendsList">
                            <p class="text-base-content/60 text-center py-4 italic">No friends yet. Search for users to add!</p>
                        </div>
                    </div>

                    <!-- Active Games Section -->
                    <div>
                        <h2 class="text-xl font-bold mb-4">Active Games</h2>
                        <div id="gamesList" class="space-y-2">
                            <p class="text-base-content/60 text-center py-8 italic">Connecting to server...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Page -->
    <div id="gamePage" class="page" style="display: none;">
        <div class="game-container" style="justify-content:center;align-items:center;">
            <main class="board-area" style="min-width:0;min-height:0;padding:10px;">
                <div class="board-wrapper-game" style="gap:8px;">
                    <svg id="boardSvg" class="board-svg" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet"></svg>
                    <div id="boardPlaceholder" class="board-placeholder">Waiting for game to start...</div>
                    <div class="game-controls" style="margin-top:16px;display:flex;gap:12px;justify-content:center;">
                        <button id="rollBtn" class="btn btn-primary btn-lg" disabled>Roll Dice</button>
                        <button id="endTurnBtn" class="btn btn-secondary btn-lg" disabled>End Turn</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Login Modal -->
    <dialog id="loginModal" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box">
            <h3 class="font-bold text-lg mb-4">Login</h3>
            <div class="form-control w-full">
                <input type="text" id="loginUsername" placeholder="Username" class="input input-bordered w-full" autocomplete="username">
            </div>
            <div class="form-control w-full mt-3">
                <input type="password" id="loginPassword" placeholder="Password" class="input input-bordered w-full" autocomplete="current-password">
            </div>
            <p id="loginError" class="text-error text-sm mt-2 min-h-5"></p>
            <div class="modal-action flex-col gap-2 mt-4">
                <button onclick="performLogin()" class="btn btn-primary w-full">Login</button>
                <button onclick="hideLoginModal()" class="btn btn-ghost w-full">Cancel</button>
            </div>
            <p class="text-center text-sm mt-4 text-base-content/70">
                Don't have an account?
                <a href="#" class="link link-primary" onclick="hideLoginModal(); showRegisterModal();">Sign up</a>
            </p>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Register Modal -->
    <dialog id="registerModal" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box">
            <h3 class="font-bold text-lg mb-4">Create Account</h3>
            <div class="form-control w-full">
                <input type="text" id="regUsername" placeholder="Username (3-20 chars)" class="input input-bordered w-full" autocomplete="username">
            </div>
            <div class="form-control w-full mt-3">
                <input type="text" id="regDisplayName" placeholder="Display Name (optional)" class="input input-bordered w-full">
            </div>
            <div class="form-control w-full mt-3">
                <input type="password" id="regPassword" placeholder="Password (8+ chars)" class="input input-bordered w-full" autocomplete="new-password">
            </div>
            <div class="form-control w-full mt-3">
                <input type="password" id="regPasswordConfirm" placeholder="Confirm Password" class="input input-bordered w-full" autocomplete="new-password">
            </div>
            <div class="form-control w-full mt-3">
                <input type="email" id="regEmail" placeholder="Email (optional)" class="input input-bordered w-full">
            </div>
            <div class="alert alert-info mt-4 text-sm">
                <span>Your anonymous game history will be linked to this account.</span>
            </div>
            <p id="registerError" class="text-error text-sm mt-2 min-h-5"></p>
            <div class="modal-action flex-col gap-2 mt-4">
                <button onclick="performRegister()" class="btn btn-primary w-full">Create Account</button>
                <button onclick="hideRegisterModal()" class="btn btn-ghost w-full">Cancel</button>
            </div>
            <p class="text-center text-sm mt-4 text-base-content/70">
                Already have an account?
                <a href="#" class="link link-primary" onclick="hideRegisterModal(); showLoginModal();">Login</a>
            </p>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Profile Modal -->
    <dialog id="profileModal" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box max-w-lg">
            <h3 class="font-bold text-lg mb-6">Your Profile</h3>

            <!-- Account Info -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Account Info</h4>
                <p class="mb-2"><span class="text-base-content/70">Username:</span> <span id="profileUsername" class="font-semibold"></span></p>
                <div class="form-control w-full">
                    <label class="label">
                        <span class="label-text">Display Name</span>
                    </label>
                    <input type="text" id="profileDisplayName" class="input input-bordered w-full">
                </div>
                <button onclick="updateProfile()" class="btn btn-primary btn-sm mt-3">Update</button>
            </div>

            <div class="divider"></div>

            <!-- Statistics -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Statistics</h4>
                <div class="stats stats-vertical sm:stats-horizontal shadow w-full bg-base-200">
                    <div class="stat place-items-center">
                        <div class="stat-title">Games</div>
                        <div class="stat-value text-primary" id="statTotalGames">0</div>
                    </div>
                    <div class="stat place-items-center">
                        <div class="stat-title">Wins</div>
                        <div class="stat-value text-success" id="statWins">0</div>
                    </div>
                    <div class="stat place-items-center">
                        <div class="stat-title">Win Rate</div>
                        <div class="stat-value" id="statWinRate">0%</div>
                    </div>
                    <div class="stat place-items-center">
                        <div class="stat-title">Best Streak</div>
                        <div class="stat-value text-warning" id="statBestStreak">0</div>
                    </div>
                </div>
            </div>

            <div class="modal-action">
                <button onclick="hideProfileModal()" class="btn btn-ghost">Close</button>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Quick Join Modal (hidden) -->
    <input type="text" id="serverUrl" value="http://localhost:5000/gamehub" style="display: none;">

    <!-- SignalR JavaScript Client -->
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script src="/auth.js"></script>
    <script src="/friends.js"></script>
    <script src="/board-svg.js"></script>
    <script src="/game.js"></script>
</body>
</html>
